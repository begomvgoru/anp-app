<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<meta name="theme-color" content="#e9edf4" />
<title>Зоны от АНП — compact hearts</title>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&display=swap" rel="stylesheet">

<!-- Версия 1.1 -->

<style>
  :root{
    --bg:#e9edf4; --ink:#2b2f36; --muted:#6e7785; --panel:#e9edf4;
    --accent:#EF233C;
    --shadow-dark:#c8cdd6; --shadow-light:#ffffff; --radius:20px;
  }

  *{box-sizing:border-box}
  html,body{height:100%; overflow-x:hidden;}
  body{
    margin:0; color:var(--ink); font-family:'Bebas Neue',system-ui,-apple-system,Roboto,Arial;
    background: radial-gradient(1200px 900px at 50% -10%, #f5f8fc 0%, transparent 70%), var(--bg);
    -webkit-tap-highlight-color: transparent; touch-action: manipulation;
  }

  .viewport{min-height:100svh; padding:clamp(4px,2vh,12px); display:flex; align-items:center; justify-content:center;}
  .shell{width:min(460px,100%);} 

  .card{
    background:var(--panel); border-radius:24px; padding:12px;
    box-shadow:12px 12px 24px var(--shadow-dark), -12px -12px 24px var(--shadow-light);
    overflow:hidden;
  }

  /* РАДАР */
  .radar{position:relative; height:110px; margin:4px 0 10px; border-radius:20px; overflow:hidden;
         background:var(--panel); box-shadow: inset 6px 6px 12px var(--shadow-dark), inset -6px -6px 12px var(--shadow-light);} 
  .heart{position:absolute; left:50%; top:50%; transform:translate(-50%,-50%);
         width:56px; height:56px; border-radius:50%; display:grid; place-items:center; color:#fff;
         background:radial-gradient(circle at 30% 30%, #ff5a6f, var(--accent));
         box-shadow:0 8px 14px rgba(239,35,60,.22), inset 0 1px 0 rgba(255,255,255,.35);} 
  .heart:before{content:"❤"; font-size:22px;}
  .ecg-wrap{position:absolute; left:12px; right:12px; bottom:8px; height:38px;}
  svg.ecg{width:100%; height:100%}
  .trace{fill:none; stroke:var(--accent); stroke-width:2.2; stroke-dasharray:560 560; stroke-dashoffset:560; animation:draw 3.2s linear infinite;}
  @keyframes draw{from{stroke-dashoffset:560;} to{stroke-dashoffset:0;}}

  /* ФОРМА */
  .form{display:flex; flex-direction:column; align-items:center; gap:6px; margin:0 0 10px;}
  .form .hint{font-size:13px; color:var(--muted);} 
  label{ color:var(--muted); font-size:15px;}
  .input{
    height:46px; width:100%; max-width:280px; text-align:center;
    border-radius:14px; outline:none; padding:0 12px; font-size:22px; font-family:'Bebas Neue',sans-serif; color:var(--ink);
    border:0; background:var(--panel);
    box-shadow: inset 6px 6px 12px var(--shadow-dark), inset -6px -6px 12px var(--shadow-light);
  }
  .btn-red{
    background:linear-gradient(180deg,#ff5a6f,var(--accent));
    border:none; color:#fff; text-align:center; padding:12px; border-radius:18px;
    display:flex; justify-content:center; align-items:center;
    box-shadow:8px 8px 14px rgba(239,35,60,.2), -6px -6px 14px rgba(255,255,255,.6), inset 0 1px 0 rgba(255,255,255,.25);
    transition:transform .1s ease; cursor:pointer; width:100%; max-width:380px; font-size:16px; margin-top:6px;
  }
  .pressed{transform:scale(.97);} 

  /* ПЛИТКИ ЗОН */
  .tiles{display:grid; grid-template-columns:repeat(2,minmax(0,1fr)); gap:8px; margin-top:6px; margin-bottom:10px; width:100%;}
  @media (max-width:360px){ .tiles{ grid-template-columns:minmax(0,1fr); } }

  .tile{
    background:var(--panel);
    border-radius:16px;
    padding:10px; text-align:center;
    display:flex; flex-direction:column; align-items:center; gap:4px;
    box-shadow:6px 6px 12px var(--shadow-dark), -6px -6px 12px var(--shadow-light);
    cursor:pointer;
  }

  .tile.pulse{ animation:pulse 1.2s ease-in-out infinite; }
  @keyframes pulse{0%{ transform:scale(1);}50%{ transform:scale(1.02);}100%{ transform:scale(1);} }

  .zone-row{display:flex; align-items:center; justify-content:center; gap:4px;}
  .zone-title{font-size:14px; color:var(--ink);} 
  .hearts{display:flex; gap:2px;}
  .hearts span{ font-size:9px; line-height:1; color:#bbb; }
  .hearts span.active{color:var(--accent);} 
  .zone-desc{font-size:13px; color:var(--muted);} 
  .num{font-size:20px; font-family:'Bebas Neue',sans-serif;}

  /* Кнопка подсказки */
  .tile-red{grid-column:1 / -1; font-size:14px; margin-top:6px; background:linear-gradient(180deg,#ff5a6f,var(--accent)); border:none; color:#fff; text-align:center; padding:12px; border-radius:16px; display:flex; justify-content:center; align-items:center; box-shadow:8px 8px 14px rgba(239,35,60,.2), -6px -6px 14px rgba(255,255,255,.6), inset 0 1px 0 rgba(255,255,255,.25); transition:transform .1s ease; cursor:pointer;}
/* === Compact tweaks for one-screen fit (override) === */
  .viewport{padding:clamp(6px,1.8vh,14px);} 
  .radar{height:96px; margin:4px 0 10px;}
  .heart{width:56px; height:56px;}
  .heart:before{font-size:24px;}
  .ecg-wrap{left:12px; right:12px; bottom:8px; height:38px;}
  .trace{stroke-width:2.2;}
  .form{gap:6px; margin-bottom:10px;}
  .input{height:48px; font-size:22px; font-family:system-ui, -apple-system, Roboto, Arial;}
  .btn-red{padding:12px; border-radius:18px; font-size:16px; margin-top:6px;}
  .tiles{gap:8px; margin-bottom:10px;}
  .tile{padding:10px; border-radius:18px;}
  .num{font-size:20px; font-family:'Bebas Neue', system-ui, -apple-system, Roboto, Arial;}
  .tile-red{padding:12px; font-size:15px; border-radius:18px;}
  @media (max-height: 740px){
    .radar{height:88px;} .heart{width:52px; height:52px;} .input{height:46px; font-size:20px;}
    .btn-red{padding:10px; font-size:15px;} .num{font-size:19px; font-family:'Bebas Neue', system-ui, -apple-system, Roboto, Arial;}
  }
</style>
</head>
<body>
  <div class="viewport">
    <div class="shell">
      <div class="card">
        <div class="radar">
          <div class="heart"></div>
          <div class="ecg-wrap">
            <svg class="ecg" viewBox="0 0 600 100" preserveAspectRatio="none">
              <path class="trace" d="M0 60 C20 58,35 62,55 60 L80 60 90 50 100 70 110 40 120 75 130 60
              C160 58,190 62,220 60 L240 60 250 50 260 70 270 45 280 75 290 60
              C320 58,350 62,380 60 L400 60 410 50 420 70 430 42 440 76 450 60
              C480 58,520 62,560 60 L600 60"/>
            </svg>
          </div>
        </div>

        <div class="form">
          <div style="text-align:center">
            <label for="anp">Мой анаэробный порог</label>
            <div class="hint">уд/мин</div>
          </div>
          <input id="anp" class="input" type="number" min="60" max="220" value="165" inputmode="numeric" pattern="[0-9]*" />
          <button class="btn-red" id="doCalc">Рассчитать мой анаэробный порог</button>
        </div>

        <div class="tiles" id="zonesGrid"></div>

        <div class="tile-red" id="helpTile">Как узнать свой<br>анаэробный порог</div>
      </div>
    </div>
  </div>

  <div class="backdrop" id="modal">
    <div class="modal">
      <header>
        <h3 id="modalTitle">Подсказка</h3>
        <button class="close" id="modalClose" aria-label="Закрыть">×</button>
      </header>
      <div class="content" id="modalContent">
        <p>Беги 1 час максимально равномерно. Средний пульс за 60 минут — твой АНП.</p>
      </div>
    </div>
  </div>

<script>
  const $ = s => document.querySelector(s);
  let pulseIndex = 0;
  let clearedOnce = false;
  let lastValidANP = 165;

  function calcZones(anp){
    const r=n=>Math.round(n);
    return [
      {name:'ЗОНА 1',desc:'Восстановительная', val:`< ${r(anp*0.85)}`},
      {name:'ЗОНА 2',desc:'Аэробная',          val:`${r(anp*0.85)} – ${r(anp*0.95)}`},
      {name:'ЗОНА 3',desc:'Пороговая',         val:`${r(anp*0.95)} – ${r(anp*1.05)}`},
      {name:'ЗОНА 4',desc:'Субмаксимальная',   val:`${r(anp*1.05)} – ${r(anp*1.15)}`},
      {name:'ЗОНА 5',desc:'Максимальная',      val:`> ${r(anp*1.15)}`}
    ];
  }

  function zoneInfo(i){
    const infos=[
      {title:'ЗОНА 1 — Восстановительная', html:'<p>Описание зоны 1…</p>'},
      {title:'ЗОНА 2 — Аэробная база', html:'<p>Описание зоны 2…</p>'},
      {title:'ЗОНА 3 — Пороговая', html:'<p>Описание зоны 3…</p>'},
      {title:'ЗОНА 4 — Субмаксимальная', html:'<p>Описание зоны 4…</p>'},
      {title:'ЗОНА 5 — Максимальная', html:'<p>Описание зоны 5…</p>'},
    ];
    return infos[i];
  }

  function getANP(){
    let v = parseInt($('#anp').value,10);
    if (Number.isNaN(v)) v = lastValidANP;
    v = Math.max(60, Math.min(220, v));
    lastValidANP = v;
    return v;
  }

  function render(){
    const v = getANP();
    const list = calcZones(v);
    const grid = $('#zonesGrid');
    grid.innerHTML = '';

    list.forEach((z,i)=>{
      let hearts = '';
      for(let h=1; h<=5; h++){
        const active = h<=i+1;
        const char = active ? '❤' : '♡';
        hearts += `<span class="${active ? 'active' : ''}">${char}</span>`;
      }
      const el = document.createElement('div');
      el.className = 'tile';
      const info = zoneInfo(i);
      el.dataset.index = i;
      el.dataset.title = info.title;
      el.dataset.html = info.html;
      el.innerHTML = `
        <div class="zone-row">
          <div class="zone-title">${z.name}</div>
          <div class="hearts">${hearts}</div>
        </div>
        <div class="zone-desc">${z.desc}</div>
        <div class="num">${z.val}</div>
      `;
      el.addEventListener('click', ()=> openInfo(i));
      grid.appendChild(el);
    });

    pulseIndex = 0;
    applyPulse(pulseIndex);
  }

  function applyPulse(idx){
    const tiles = document.querySelectorAll('.tile');
    tiles.forEach(t=>t.classList.remove('pulse'));
    if(tiles[idx]) tiles[idx].classList.add('pulse');
  }

  function openInfo(index){
    const info = zoneInfo(index);
    $('#modalTitle').textContent = info.title;
    $('#modalContent').innerHTML = info.html;
    $('#modal').classList.add('show');

    const onClose = ()=>{
      $('#modal').classList.remove('show');
      pulseIndex = Math.min(index+1, 4);
      applyPulse(pulseIndex);
      detach();
    };
    const onBackdrop = (e)=>{ if(e.target === $('#modal')) onClose(); };
    const onKey = (e)=>{ if(e.key==='Escape') onClose(); };

    function detach(){
      $('#modalClose').removeEventListener('click', onClose);
      $('#modal').removeEventListener('click', onBackdrop);
      document.removeEventListener('keydown', onKey);
    }

    $('#modalClose').addEventListener('click', onClose, {once:true});
    $('#modal').addEventListener('click', onBackdrop, {once:true});
    document.addEventListener('keydown', onKey, {once:true});
  }

  function bindPress(el){
    if(!el) return;
    const add = ()=> el.classList.add('pressed');
    const rm  = ()=> el.classList.remove('pressed');
    el.addEventListener('touchstart', add, {passive:true});
    el.addEventListener('touchend', rm);
    el.addEventListener('mousedown', add);
    el.addEventListener('mouseup', rm);
    el.addEventListener('mouseleave', rm);
  }

  bindPress($('#doCalc'));
  bindPress($('#helpTile'));
  $('#doCalc').addEventListener('click', render);
  $('#anp').addEventListener('keydown', e=>{ if(e.key==='Enter') render(); });
  $('#anp').addEventListener('focus', e=>{ if(!clearedOnce){ e.target.value=''; clearedOnce=true; } });
  $('#anp').addEventListener('blur', e=>{ if(!e.target.value){ e.target.value = lastValidANP; } });
  $('#helpTile').addEventListener('click', ()=>{
    $('#modalTitle').textContent = 'Как определить АНП';
    $('#modalContent').innerHTML = '<p>Беги 1 час максимально равномерно. Средний пульс за 60 минут — твой АНП.</p>';
    $('#modal').classList.add('show');
  });

  render();
</script>
</body>
</html>



