<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<meta name="theme-color" content="#1c1c1c" />
<title>Зоны от АНП — compact hearts (Dark)</title>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&display=swap" rel="stylesheet">

<style>
  :root{
    --bg:#1c1c1c; --ink:#e9edf4; --muted:#a0a4ae; --panel:#2a2a2a;
    --accent:#EF233C;
    --shadow-dark:#121212; --shadow-light:#333333; --radius:20px;
  }

  *{box-sizing:border-box}
  html,body{height:100%; overflow-x:hidden;}
  body{
    margin:0; color:var(--ink); font-family:'Bebas Neue',system-ui,-apple-system,Roboto,Arial;
    background: var(--bg);
    -webkit-tap-highlight-color: transparent; touch-action: manipulation;
  }

  .viewport{min-height:100svh; padding:clamp(4px,2vh,12px); display:flex; align-items:center; justify-content:center;}
  .shell{width:min(460px,100%);} 

  .card{
    background:var(--panel); border-radius:24px; padding:12px;
    box-shadow:6px 6px 12px var(--shadow-dark), -6px -6px 12px var(--shadow-light);
    overflow:visible; /* для модалки */
  }

  /* РАДАР */
  .radar{position:relative; height:110px; margin:4px 0 10px; border-radius:20px; overflow:hidden;
         background:var(--panel); box-shadow: inset 6px 6px 12px var(--shadow-dark), inset -6px -6px 12px var(--shadow-light);} 
  .heart{position:absolute; left:50%; top:50%; transform:translate(-50%,-50%);
         width:56px; height:56px; border-radius:50%; display:grid; place-items:center; color:#fff;
         background:radial-gradient(circle at 30% 30%, #ff5a6f, var(--accent));
         box-shadow:0 8px 14px rgba(239,35,60,.35), inset 0 1px 0 rgba(255,255,255,.25);} 
  .heart:before{content:"❤"; font-size:22px;}
  .ecg-wrap{position:absolute; left:12px; right:12px; bottom:8px; height:38px;}
  svg.ecg{width:100%; height:100%}
  .trace{fill:none; stroke:var(--accent); stroke-width:2.2; stroke-dasharray:560 560; stroke-dashoffset:560; animation:draw 3.2s linear infinite;}
  @keyframes draw{from{stroke-dashoffset:560;} to{stroke-dashoffset:0;}}

  /* ФОРМА */
  .form{display:flex; flex-direction:column; align-items:center; gap:6px; margin:0 0 10px;}
  .form .hint{font-size:13px; color:var(--muted);} 
  label{ color:var(--muted); font-size:15px;}
  .input{
    height:46px; width:100%; max-width:280px; text-align:center;
    border-radius:14px; outline:none; padding:0 12px; font-size:22px; font-family:'Bebas Neue',sans-serif; color:var(--ink);
    border:0; background:var(--panel);
    box-shadow: inset 6px 6px 12px var(--shadow-dark), inset -6px -6px 12px var(--shadow-light);
  }

  /* Красные кнопки (верхняя и нижняя одинаковые, по центру) */
  .btn-red{
    background:linear-gradient(180deg,#ff5a6f,var(--accent));
    border:none; color:#fff; text-align:center; padding:12px; border-radius:18px;
    display:flex; justify-content:center; align-items:center;
    box-shadow:0 0 12px rgba(239,35,60,.4);
    transition:transform .1s ease; cursor:pointer; width:100%; max-width:380px;
    font-size:16px; font-family:'Bebas Neue',sans-serif;
    margin:6px auto 0; /* центрирование */
  }
  .pressed{transform:scale(.97);} 

  /* ПЛИТКИ ЗОН */
  .tiles{display:grid; grid-template-columns:repeat(2,minmax(0,1fr)); gap:8px; margin-top:6px; margin-bottom:10px; width:100%;}
  @media (max-width:360px){ .tiles{ grid-template-columns:minmax(0,1fr); } }

  .tile{
    background:var(--panel);
    border-radius:16px;
    padding:10px; text-align:center;
    display:flex; flex-direction:column; align-items:center; gap:4px;
    box-shadow:inset 2px 2px 6px var(--shadow-dark), inset -2px -2px 6px var(--shadow-light);
    cursor:pointer;
    position: relative; /* для подсветки */
  }

  .tile.pulse{ animation:pulse 1.2s ease-in-out infinite; }
  @keyframes pulse{0%{ transform:scale(1);}50%{ transform:scale(1.02);}100%{ transform:scale(1);} }

  /* полупрозрачная подсветка активной карточки */
  .tile::after{ content:""; position:absolute; inset:0; border-radius:inherit; background:var(--accent); opacity:0; transition: opacity .2s ease; pointer-events:none; }
  .tile.pulse::after{ opacity:.2; }

  .zone-row{display:flex; align-items:center; justify-content:center; gap:4px;}
  .zone-title{font-size:14px; color:var(--ink);} 
  .hearts{display:flex; gap:2px;}
  .hearts span{ font-size:9px; line-height:1; color:#666; }
  .hearts span.active{color:var(--accent);} 
  .zone-desc{font-size:13px; color:var(--muted);} 
  .num{font-size:20px; font-family:'Bebas Neue',sans-serif;}

  /* Модалка */
  .backdrop{position:fixed; inset:0; background:rgba(0,0,0,.55); display:none; align-items:center; justify-content:center;
            padding:18px; z-index:9999; opacity:0; transition:opacity .18s ease;}
  .backdrop.show{display:flex; opacity:1;}
  .modal{width:min(360px,100%); background:var(--panel); border-radius:20px; padding:14px 16px; text-align:left;
         box-shadow:0 0 20px rgba(0,0,0,.6);} 
  .modal header{display:flex; align-items:center; justify-content:space-between; gap:10px; margin-bottom:6px;}
  .modal h3{font-size:18px; margin:2px 0; color:var(--ink);}
  .modal .content{color:var(--muted); font-size:14px; line-height:1.4; max-height:50vh; overflow:auto;}
  .close{appearance:none; border:0; background:transparent; font-size:22px; cursor:pointer; color:var(--muted);} 

  /* Только для нижней — в одну строку */
  #helpTile{ white-space:nowrap; }
</style>
</head>
<body>
  <div class="viewport">
    <div class="shell">
      <div class="card">
        <div class="radar">
          <div class="heart"></div>
          <div class="ecg-wrap">
            <svg class="ecg" viewBox="0 0 600 100" preserveAspectRatio="none">
              <path class="trace" d="M0 60 C20 58,35 62,55 60 L80 60 90 50 100 70 110 40 120 75 130 60
              C160 58,190 62,220 60 L240 60 250 50 260 70 270 45 280 75 290 60
              C320 58,350 62,380 60 L400 60 410 50 420 70 430 42 440 76 450 60
              C480 58,520 62,560 60 L600 60"/>
            </svg>
          </div>
        </div>

        <div class="form">
          <div style="text-align:center">
            <label for="anp">Мой анаэробный порог</label>
            <div class="hint">уд/мин</div>
          </div>
          <input id="anp" class="input" type="number" min="60" max="220" value="165" inputmode="numeric" pattern="[0-9]*" />
          <button class="btn-red" id="doCalc">Рассчитать мои зоны пульса</button>
        </div>

        <div class="tiles" id="zonesGrid"></div>

        <!-- Нижняя кнопка: идентична верхней, по центру, в одну строку -->
        <button class="btn-red" id="helpTile">Как узнать свой анаэробный порог</button>
      </div>
    </div>
  </div>

  <div class="backdrop" id="modal">
    <div class="modal">
      <header>
        <h3 id="modalTitle">Подсказка</h3>
        <button class="close" id="modalClose" aria-label="Закрыть">×</button>
      </header>
      <div class="content" id="modalContent">
        <p>Беги 1 час максимально равномерно. Средний пульс за 60 минут — твой АНП.</p>
      </div>
    </div>
  </div>

<script>
  const $ = s => document.querySelector(s);
  let pulseIndex = 0;
  let clearedOnce = false;
  let lastValidANP = 165;

  function calcZones(anp){
    const r=n=>Math.round(n);
    return [
      {name:'ЗОНА 1',desc:'Восстановительная', val:`< ${r(anp*0.85)}`},
      {name:'ЗОНА 2',desc:'Аэробная',          val:`${r(anp*0.85)} – ${r(anp*0.95)}`},
      {name:'ЗОНА 3',desc:'Темповая',         val:`${r(anp*0.95)} – ${r(anp*1.05)}`},
      {name:'ЗОНА 4',desc:'Пороговая',   val:`${r(anp*1.05)} – ${r(anp*1.15)}`},
      {name:'ЗОНА 5',desc:'интервальная VO₂max',      val:`> ${r(anp*1.15)}`}
    ];
  }

  function zoneInfo(i){
    const infos = [
      {
        title: 'ЗОНА 1 — Восстановительная',
        html: `
          <p><strong>Первая пульсовая зона в беге</strong> — это самая лёгкая по интенсивности зона тренировок, которая ориентируется на низкий уровень сердечного ритма.</p>
          <p><strong>Пульс:</strong> примерно 50–60% от максимального, зависит от возраста и индивидуальных особенностей.</p>
          <p><strong>Ощущения:</strong> очень лёгкий бег, «разговорный темп» — можно спокойно разговаривать, не задыхаясь.</p>
          <p><strong>Физиология:</strong></p>
          <ul>
            <li>мышцы работают в условиях полного обеспечения кислородом, молочная кислота практически не накапливается;</li>
            <li>сердце укрепляется мягко — увеличивается ударный объём (за одно сокращение выталкивается больше крови), но без перегрузки;</li>
            <li>улучшается экономичность дыхания, дыхательные мышцы работают без стресса;</li>
            <li>включается парасимпатический отдел нервной системы → снижение стресса, улучшение восстановления и сна;</li>
            <li>активируется липолиз (расщепление жиров), снижается уровень кортизола.</li>
          </ul>
          <p>Зона 1 — это зона восстановления и “фундаментальная база”. Она не делает вас быстрее напрямую, но позволяет организму адаптироваться и выдерживать более тяжёлые тренировки без перетренированности.</p>
          <p><strong>Тренировки в этой зоне:</strong></p>
          <ul>
            <li>Восстановительные пробежки после тяжёлых тренировок или стартов.</li>
            <li>Разминка и заминка (начала и окончания тренировки).</li>
            <li>Длительные лёгкие пробежки для новичков.</li>
            <li>Ходьба и бег трусцой для снижения стресса и наработки общей базы выносливости.</li>
          </ul>
        `
      },
      {title:'ЗОНА 2 — Аэробная база', html:'<p>Описание зоны 2…</p>'},
      {title:'ЗОНА 3 — Пороговая', html:'<p>Описание зоны 3…</p>'},
      {title:'ЗОНА 4 — Субмаксимальная', html:'<p>Описание зоны 4…</p>'},
      {title:'ЗОНА 5 — Максимальная', html:'<p>Описание зоны 5…</p>'},
    ];
    return infos[i];
  }

  function getANP(){
    let v = parseInt($('#anp').value,10);
    if (Number.isNaN(v)) v = lastValidANP;
    v = Math.max(60, Math.min(220, v));
    lastValidANP = v;
    return v;
  }

  function render(){
    const v = getANP();
    const list = calcZones(v);
    const grid = $('#zonesGrid');
    grid.innerHTML = '';

    list.forEach((z,i)=>{
      let hearts = '';
      for(let h=1; h<=5; h++){
        const active = h<=i+1;
        const char = active ? '❤' : '♡';
        hearts += `<span class="${active ? 'active' : ''}">${char}</span>`;
      }
      const el = document.createElement('div');
      el.className = 'tile';
      const info = zoneInfo(i);
      el.dataset.index = i;
      el.dataset.title = info.title;
      el.dataset.html = info.html;
      el.innerHTML = `
        <div class="zone-row">
          <div class="zone-title">${z.name}</div>
          <div class="hearts">${hearts}</div>
        </div>
        <div class="zone-desc">${z.desc}</div>
        <div class="num">${z.val}</div>
      `;
      el.addEventListener('click', ()=> openInfo(i));
      grid.appendChild(el);
    });
  }

  function applyPulse(idx){
    const tiles = document.querySelectorAll('.tile');
    tiles.forEach(t=>t.classList.remove('pulse'));
    if(tiles[idx]) tiles[idx].classList.add('pulse');
  }

  // Общая функция модалки
  function openModal(title, html, advanceIndex){
    $('#modalTitle').textContent = title;
    $('#modalContent').innerHTML = html;
    $('#modal').classList.add('show');

    const onClose = ()=>{
      $('#modal').classList.remove('show');
      if (typeof advanceIndex === 'number') {
        if (advanceIndex < 4) {
          const next = Math.min(advanceIndex + 1, 4);
          applyPulse(next);
        } else {
          // закрыли 5-ю — сбросить пульсацию в исходное состояние
          const tiles = document.querySelectorAll('.tile');
          tiles.forEach(t=>t.classList.remove('pulse'));
        }
      }
      detach();
    };
    const onBackdrop = (e)=>{ if(e.target === $('#modal')) onClose(); };
    const onKey = (e)=>{ if(e.key==='Escape') onClose(); };

    function detach(){
      $('#modalClose').removeEventListener('click', onClose);
      $('#modal').removeEventListener('click', onBackdrop);
      document.removeEventListener('keydown', onKey);
    }

    $('#modalClose').addEventListener('click', onClose, {once:true});
    $('#modal').addEventListener('click', onBackdrop, {once:true});
    document.addEventListener('keydown', onKey, {once:true});
  }

  function openInfo(index){
    const info = zoneInfo(index);
    openModal(info.title, info.html, index);
  }

  function bindPress(el){
    if(!el) return;
    const add = ()=> el.classList.add('pressed');
    const rm  = ()=> el.classList.remove('pressed');
    el.addEventListener('touchstart', add, {passive:true});
    el.addEventListener('touchend', rm);
    el.addEventListener('mousedown', add);
    el.addEventListener('mouseup', rm);
    el.addEventListener('mouseleave', rm);
  }

  bindPress($('#doCalc'));
  bindPress($('#helpTile'));

  // «Рассчитать»: пересчёт + старт пульсации с 1-й карточки
  $('#doCalc').addEventListener('click', ()=>{
    render();
    pulseIndex = 0;
    applyPulse(pulseIndex);
  });

  $('#anp').addEventListener('keydown', e=>{
    if(e.key==='Enter'){
      render();
      pulseIndex = 0;
      applyPulse(pulseIndex);
    }
  });
  $('#anp').addEventListener('focus', e=>{ if(!clearedOnce){ e.target.value=''; clearedOnce=true; } });
  $('#anp').addEventListener('blur', e=>{ if(!e.target.value){ e.target.value = lastValidANP; } });

  // Нижняя кнопка — подсказка, без изменения пульсации
  $('#helpTile').addEventListener('click', ()=>{
    openModal(
      'Как узнать свой анаэробный порог',
      `
      <p>Беги один час в максимально устойчивом темпе, который можешь выдержать на всём протяжении дистанции. Ваша цель — преодолеть за этот час максимально возможное расстояние. Если не получается всё время бежать, можно чередовать бег и шаг, но старайся поддерживать равномерную нагрузку.</p>
      <p>Часовой бег — это простой полевой тест для оценки анаэробного порога. Суть в том, что спортсмен движется в течение 60 минут с максимально возможной устойчивой скоростью. Средний пульс за этот интервал будет соответствовать индивидуальной частоте сердечных сокращений на уровне анаэробного порога. Это доступный и бесплатный способ оценки без лабораторных тестов.</p>
      `
    );
  });

  // Первый рендер (без пульсации)
  render();
</script>
</body>
</html>



       